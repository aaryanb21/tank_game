<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>App.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tank</a> &gt; <a href="index.source.html" class="el_package">Tanks</a> &gt; <span class="el_source">App.java</span></div><h1>App.java</h1><pre class="source lang-java linenums">package Tanks;

import processing.core.PApplet;
import processing.core.PImage;
import processing.data.JSONArray;
import processing.data.JSONObject;
import processing.event.KeyEvent;
import processing.event.MouseEvent;
import java.io.*;
import java.util.*; 

/**
 * The main class representing the Tank game application.
 * This class extends the PApplet class provided by the Processing library.
 */

public class App extends PApplet {

    // Constants defining game parameters
    public static final int CELLSIZE = 32; //8;
    public static final int CELLHEIGHT = 32;
    public static final int CELLAVG = 32;
    public static final int TOPBAR = 0;
<span class="fc" id="L24">    public static int WIDTH = 864; //CELLSIZE*BOARD_WIDTH;</span>
<span class="fc" id="L25">    public static int HEIGHT = 640; //BOARD_HEIGHT*CELLSIZE+TOPBAR;</span>
<span class="fc" id="L26">    public static final int BOARD_WIDTH = WIDTH/CELLSIZE;</span>
    public static final int BOARD_HEIGHT = 20;
    public static final int INITIAL_PARACHUTES = 3;
    public static final int FPS = 30;


    // Attributes representing game state and data
    public String configPath;
<span class="fc" id="L34">    public static Random random = new Random();</span>
    public PImage bg;
    public int level;
<span class="fc" id="L37">    public char[][] terrain = new char[28][20];</span>
    public PImage tree;
    public PImage tank;
    public PImage fuel;
    public PImage wind_left;
    public PImage wind_right;
    public PImage parachute;
    public String fgColor;
    public int turn;
    public long arrowDisplayTime;
    public int tankCount; 
    public int initialTankCount;
    public boolean scoreDisplayed;
<span class="fc" id="L50">    public int[] terrainNew = new int[896];</span>
<span class="fc" id="L51">    public ArrayList&lt;Tank&gt; tankArr = new ArrayList&lt;Tank&gt;();</span>
<span class="fc" id="L52">    public ArrayList&lt;Tree&gt; treeArr = new ArrayList&lt;Tree&gt;();</span>
<span class="fc" id="L53">    public int wind = random.nextInt(71) - 35;</span>
<span class="fc" id="L54">    public boolean teleportStatus = false;</span>
<span class="fc" id="L55">    public boolean airStrikeStatus = false;</span>
<span class="fc" id="L56">    public boolean isGameOver = false;</span>
<span class="fc" id="L57">    public boolean showPowerUp = false;</span>
<span class="fc" id="L58">    public Explosion e = null;</span>

    //Variables for final scoreboard
<span class="fc" id="L61">    public int currentIndex = 0;</span>
<span class="fc" id="L62">    public long lastWordTime = 0;</span>
<span class="fc" id="L63">    public long wordInterval = 700; // Interval between words in milliseconds</span>
<span class="fc" id="L64">    public ArrayList&lt;Tank&gt; displayedTanks = new ArrayList&lt;&gt;();</span>

    /**
     * Main constructor of the App class.
     * Initializes the configuration file path.
     */
<span class="fc" id="L70">    public App() {</span>
<span class="fc" id="L71">        this.configPath = &quot;config.json&quot;;</span>
<span class="fc" id="L72">    }</span>

    /**
     * Settings method to initialize the window size.
     */
	@Override
    public void settings() {
<span class="fc" id="L79">        size(WIDTH, HEIGHT);</span>
<span class="fc" id="L80">    }</span>

    /**
     * Setup method to initialize game resources and elements.
     */
	@Override
    public void setup() {

<span class="fc" id="L88">        currentIndex = 0;</span>
<span class="fc" id="L89">        tankCount = 0;</span>
<span class="fc" id="L90">        initialTankCount = 0;</span>
<span class="fc" id="L91">        turn = 1;</span>
<span class="fc" id="L92">        this.level = 1;</span>
<span class="fc" id="L93">        this.scoreDisplayed = false;</span>
<span class="fc" id="L94">        treeArr.clear();</span>
<span class="fc" id="L95">        tankArr.clear();</span>
<span class="fc" id="L96">        displayedTanks.clear();</span>

        //Emptying old terrain array
<span class="fc bfc" id="L99" title="All 2 branches covered.">        for (int i = 0; i &lt; 28; i++){</span>
<span class="fc" id="L100">            Arrays.fill(terrain[i], ' ');</span>
        }
<span class="fc" id="L102">        frameRate(FPS);</span>
 
<span class="fc" id="L104">        JSONObject config = loadJSONObject(this.configPath);</span>
<span class="fc" id="L105">        JSONArray levelArray = config.getJSONArray(&quot;levels&quot;);</span>
<span class="fc" id="L106">        JSONObject current_level = levelArray.getJSONObject(this.level-1);</span>

<span class="fc" id="L108">        this.bg = loadImage(&quot;src/main/resources/Tanks/&quot; + current_level.getString(&quot;background&quot;));</span>
<span class="fc" id="L109">        this.fgColor = current_level.getString(&quot;foreground-colour&quot;);</span>
<span class="fc" id="L110">        this.tree = loadImage(&quot;src/main/resources/Tanks/&quot; + current_level.getString(&quot;trees&quot;, &quot;tree1.png&quot;));</span>
<span class="fc" id="L111">        this.fuel = loadImage(&quot;src/main/resources/Tanks/fuel.png&quot;);</span>
<span class="fc" id="L112">        this.wind_left = loadImage(&quot;src/main/resources/Tanks/wind-1.png&quot;);</span>
<span class="fc" id="L113">        this.wind_left.resize(32, 32);</span>
<span class="fc" id="L114">        this.wind_right = loadImage(&quot;src/main/resources/Tanks/wind.png&quot;);</span>
<span class="fc" id="L115">        this.wind_right.resize(32, 32);</span>
<span class="fc" id="L116">        this.parachute = loadImage(&quot;src/main/resources/Tanks/parachute.png&quot;);</span>
<span class="fc" id="L117">        this.parachute.resize(32, 32);</span>
        
        //Initializing array full of blank tanks

<span class="fc" id="L121">        loadTerrain(current_level.getString(&quot;layout&quot;));    </span>
<span class="fc" id="L122">        transfer();</span>
<span class="fc" id="L123">        smoothTerrain();</span>
<span class="fc" id="L124">        smoothTerrain();</span>
<span class="fc" id="L125">        arrowDisplayTime = millis() + 2000;</span>

<span class="fc bfc" id="L127" title="All 2 branches covered.">        for (int i = 0; i &lt; 9; i++){</span>
<span class="fc" id="L128">            Tank t = null;</span>
<span class="fc bfc" id="L129" title="All 6 branches covered.">            switch (i) {</span>
                case 0:
<span class="fc" id="L131">                    t = new Tank(0,0, terrainNew, &quot;0,0,255&quot;, tankArr, 0, this.wind, (char)(i + 65));</span>
<span class="fc" id="L132">                    break;</span>
                case 1:
<span class="fc" id="L134">                    t = new Tank(0,0, terrainNew, &quot;255,0,0&quot;, tankArr, 0, this.wind, (char)(i + 65));</span>
<span class="fc" id="L135">                    break;</span>
                case 2:
<span class="fc" id="L137">                    t = new Tank(0,0, terrainNew, &quot;0,255,255&quot;, tankArr, 0, this.wind, (char)(i + 65));</span>
<span class="fc" id="L138">                    break;</span>
                case 3:
<span class="fc" id="L140">                    t = new Tank(0,0, terrainNew, &quot;255,255,0&quot;, tankArr, 0, this.wind, (char)(i + 65));</span>
<span class="fc" id="L141">                    break;</span>
                case 4:
<span class="fc" id="L143">                    t = new Tank(0,0, terrainNew, &quot;0,255,0&quot;, tankArr, 0, this.wind, (char)(i + 65));</span>
<span class="fc" id="L144">                    break;</span>
                
                default:
<span class="fc" id="L147">                    int randomR = random.nextInt(256);</span>
<span class="fc" id="L148">                    int randomG = random.nextInt(256);</span>
<span class="fc" id="L149">                    int randomB = random.nextInt(256);</span>
<span class="fc" id="L150">                    String c = Integer.toString(randomR) + &quot;,&quot; + Integer.toString(randomG) + &quot;,&quot; + Integer.toString(randomB);</span>
<span class="fc" id="L151">                    t = new Tank(0,0, terrainNew, c, tankArr, 0, this.wind, (char)(i + 65));</span>
            }
<span class="fc" id="L153">            tankArr.add(t);</span>
        }

<span class="fc" id="L156">        drawSprites();</span>
<span class="fc bfc" id="L157" title="All 2 branches covered.">        for (int i = 0; i &lt; tankArr.size(); i++){</span>
<span class="fc bfc" id="L158" title="All 2 branches covered.">            if (tankArr.get(i).getID() != 0){</span>
<span class="fc" id="L159">                tankCount++;</span>
<span class="fc" id="L160">                initialTankCount++;</span>
            }
        }
<span class="fc" id="L163">    }</span>

    /**
     * Loads terrain data from a text file and populates the terrain array.
     * Each character in the text file represents a cell in the terrain array.
     * 'X' represents a filled cell, while other characters represent empty cells.
     * The terrain array is a 2D grid representing the game's terrain layout.
     * @param fileName The path to the text file containing terrain data.
     */
    public void loadTerrain(String fileName){

        try {
<span class="fc" id="L175">            BufferedReader br = new BufferedReader(new FileReader(fileName));</span>
            
<span class="fc" id="L177">            int y = 0;</span>
            String line;

<span class="fc bfc" id="L180" title="All 2 branches covered.">            while (y &lt; 20){</span>
<span class="fc" id="L181">                line = br.readLine();</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">                if (line == null){</span>
                    ;
                }
                else{
<span class="fc bfc" id="L186" title="All 2 branches covered.">                    for (int x = 0; x &lt; line.length(); x++){</span>
<span class="fc" id="L187">                        terrain[x][y] = line.charAt(x);</span>
                    }
                }   
<span class="fc" id="L190">                y++;</span>
            }
<span class="fc" id="L192">            br.close();</span>
        }
<span class="nc" id="L194">        catch (Exception e){</span>
<span class="nc" id="L195">            e.printStackTrace();;</span>
<span class="fc" id="L196">        }   </span>
<span class="fc" id="L197">    }</span>

    /**
     * Transfers terrain data from the 2D char array to a 1D integer array.
     * The 1D array stores the height of each column in the terrain grid.
     * Each filled cell ('X') in the terrain grid contributes to the height of the corresponding column.
     * The method assumes that the terrain array has already been populated with data.
     */
    public void transfer(){
<span class="fc bfc" id="L206" title="All 2 branches covered.">        for (int x = 0; x &lt; 28; x++){</span>
<span class="fc bfc" id="L207" title="All 2 branches covered.">            for (int y = 0; y &lt; 20; y++){</span>
<span class="fc bfc" id="L208" title="All 2 branches covered.">                if (terrain[x][y] == 'X'){</span>
<span class="fc" id="L209">                    int start = x*CELLSIZE;</span>
<span class="fc" id="L210">                    int end = start + CELLSIZE;</span>
<span class="fc bfc" id="L211" title="All 2 branches covered.">                    for (int i = start; i &lt; end; i++){</span>
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">                        if (i &lt; 896){</span>
<span class="fc" id="L213">                            terrainNew[i] = y*CELLSIZE;</span>
                        }
                    }
                } 
            }
        }
<span class="fc" id="L219">    }</span>

    /**
     * Smooths the terrain data to create a more visually appealing terrain.
     * This method calculates the moving average height of each 32-cell segment.
     * It iterates over the terrain data and replaces each segment with its moving average.
     * The method assumes that the terrain data has been transferred to the terrainNew array.
     */
    public void smoothTerrain(){
<span class="fc bfc" id="L228" title="All 2 branches covered.">        for (int i = 0; i &lt; 864; i++){</span>
<span class="fc" id="L229">            int counter = 0;</span>
<span class="fc bfc" id="L230" title="All 2 branches covered.">            for (int j = i; j &lt; i + 32; j++){</span>
<span class="fc" id="L231">                counter += terrainNew[j];</span>
            }
<span class="fc" id="L233">            terrainNew[i] = counter/32;</span>
        }
<span class="fc" id="L235">    }</span>

    /**
     * Method to load next level.
     * Loads level resources and terrain layout from the configuration file.
     */
    public void loadLevel(){
<span class="fc" id="L242">        tankCount = 0;</span>
<span class="fc" id="L243">        turn = 1;</span>

<span class="fc bfc" id="L245" title="All 2 branches covered.">        for (int i = 0; i &lt; tankArr.size(); i++){</span>
<span class="fc" id="L246">            tankArr.get(i).resetValues();</span>
<span class="fc" id="L247">            tankArr.get(i).stop();</span>
        }

<span class="fc" id="L250">        treeArr.clear();</span>

<span class="fc" id="L252">        JSONObject config = loadJSONObject(this.configPath);</span>
<span class="fc" id="L253">        JSONArray levelArray = config.getJSONArray(&quot;levels&quot;);</span>
<span class="fc" id="L254">        JSONObject current_level = levelArray.getJSONObject(level-1);</span>


<span class="fc" id="L257">        this.bg = loadImage(&quot;src/main/resources/Tanks/&quot; + current_level.getString(&quot;background&quot;));</span>
<span class="fc" id="L258">        this.fgColor = current_level.getString(&quot;foreground-colour&quot;);</span>
<span class="fc" id="L259">        this.tree = loadImage(&quot;src/main/resources/Tanks/&quot; + current_level.getString(&quot;trees&quot;, &quot;tree1.png&quot;));</span>

<span class="fc" id="L261">        loadTerrain(current_level.getString(&quot;layout&quot;));    </span>
<span class="fc" id="L262">        transfer();</span>
<span class="fc" id="L263">        smoothTerrain();</span>
<span class="fc" id="L264">        smoothTerrain();</span>
<span class="fc" id="L265">        arrowDisplayTime = millis() + 2000;</span>

<span class="fc" id="L267">        drawSprites();</span>
<span class="fc bfc" id="L268" title="All 2 branches covered.">        for (int i = 0; i &lt; tankArr.size(); i++){</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">            if (tankArr.get(i).getID() != 0){</span>
<span class="fc" id="L270">                tankCount++;</span>
            }
        }
<span class="fc" id="L273">    }</span>

    /**
     * Provides a repair power-up to the current tank player if they have enough score points.
     * If the player's tank health is below 80%, it increases the health by 20 points.
     * If the health is already 80% or more, it increases the health to 100%.
     * Deducts the required score points from the player's score.
     */

    public void repairPowerUp(){
<span class="fc" id="L283">        int score = tankArr.get(turn - 1).getScore();</span>
<span class="fc bfc" id="L284" title="All 2 branches covered.">        if (score &gt;= 20){</span>
<span class="pc bpc" id="L285" title="1 of 2 branches missed.">            if (tankArr.get(turn - 1).getHealth() &lt;= 80){</span>
<span class="fc" id="L286">                tankArr.get(turn - 1).setScore(score - 20);</span>
            }
            else {
<span class="nc" id="L289">                int change = 100 - tankArr.get(turn - 1).getHealth();</span>
<span class="nc" id="L290">                tankArr.get(turn - 1).setScore(score - change);</span>
            }
                
<span class="fc" id="L293">            tankArr.get(turn - 1).setHealth(tankArr.get(turn - 1).getHealth() + 20);</span>
        }
<span class="fc" id="L295">    }</span>

    /**
     * Provides a fuel power-up to the current tank player if they have enough score points.
     * Increases the player's tank fuel by 200 units.
     * Deducts 10 score points from the player's score.
     */

    public void fuelPowerUp(){
<span class="fc" id="L304">        int score = tankArr.get(turn - 1).getScore();</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">        if (score &gt;= 10){</span>
<span class="fc" id="L306">            tankArr.get(turn - 1).setScore(score - 10);</span>
<span class="fc" id="L307">            tankArr.get(turn - 1).setFuel(tankArr.get(turn - 1).getFuel() + 200);</span>
        }
<span class="fc" id="L309">    }</span>

    /**
     * Provides a parachute power-up to the current tank player if they have enough score points.
     * Increments the number of parachutes available to the player.
     * Deducts 15 score points from the player's score.
     */

    public void parachutePowerUp(){
<span class="fc" id="L318">        int score = tankArr.get(turn - 1).getScore();</span>
<span class="fc bfc" id="L319" title="All 2 branches covered.">        if (score &gt;= 15){</span>
<span class="fc" id="L320">            tankArr.get(turn - 1).incrementParachute();</span>
<span class="fc" id="L321">            tankArr.get(turn - 1).setScore(score - 15);</span>
        }
<span class="fc" id="L323">    }</span>

    /**
     * Activates a teleportation power-up for the current tank player if they have enough score points.
     * Allows the player to select an X coordinate to teleport their tank to.
     * Deducts 50 score points from the player's score.
     */

    public void teleportPowerUp(){
<span class="fc" id="L332">        int score = tankArr.get(turn - 1).getScore();</span>
<span class="fc bfc" id="L333" title="All 2 branches covered.">        if (score &gt;= 15){</span>
<span class="fc" id="L334">            tankArr.get(turn - 1).setScore(score - 15);</span>
<span class="fc" id="L335">            teleportStatus = true;</span>
        }

<span class="fc" id="L338">    }</span>

    /**
     * Initiates an airstrike power-up for the current tank player if they have enough score points.
     * Allows the player to select an X coordinate to launch the airstrike at.
     * Deducts the required score points from the player's score.
     */

    public void airStrikePowerUp(){
<span class="fc" id="L347">        int score = tankArr.get(turn - 1).getScore();</span>
<span class="fc bfc" id="L348" title="All 2 branches covered.">        if (score &gt;= 50){</span>
<span class="fc" id="L349">            tankArr.get(turn - 1).setScore(score - 50);</span>
<span class="fc" id="L350">            airStrikeStatus = true;</span>
        }
<span class="fc" id="L352">    }</span>

     /**
     * Method to handle keyboard inputs.
     * Responds to key presses for tank movement, shooting, power-ups, etc.
     * @param event The KeyEvent object representing the key press event.
     */
	@Override
    public void keyPressed(KeyEvent event){
<span class="pc bpc" id="L361" title="1 of 2 branches missed.">        if (isGameOver == false){</span>
<span class="fc bfc" id="L362" title="All 2 branches covered.">            if (key == CODED){</span>
<span class="fc bfc" id="L363" title="All 2 branches covered.">                if (keyCode == RIGHT){</span>
<span class="fc" id="L364">                    tankArr.get(turn - 1).moveRight();</span>
                }
    
<span class="fc bfc" id="L367" title="All 2 branches covered.">                else if (keyCode == LEFT){</span>
<span class="fc" id="L368">                    tankArr.get(turn - 1).moveLeft();</span>
                }
    
<span class="fc bfc" id="L371" title="All 2 branches covered.">                else if (keyCode == UP){</span>
<span class="fc" id="L372">                    tankArr.get(turn - 1).moveTurret(&quot;right&quot;);</span>
                }
                
<span class="pc bpc" id="L375" title="1 of 2 branches missed.">                else if (keyCode == DOWN){</span>
<span class="fc" id="L376">                    tankArr.get(turn - 1).moveTurret(&quot;left&quot;);</span>
                }
    
            
            }
<span class="fc bfc" id="L381" title="All 4 branches covered.">            if (keyPressed &amp;&amp; keyCode == 32){</span>
<span class="fc bfc" id="L382" title="All 2 branches covered.">                if (this.tankCount &lt;= 1){</span>
<span class="pc bpc" id="L383" title="1 of 2 branches missed.">                    if (this.level == 3){</span>
<span class="fc" id="L384">                        isGameOver = true;</span>
                    }
                    else{
<span class="nc" id="L387">                        this.level++;</span>
<span class="nc" id="L388">                        loadLevel();</span>
                    }
                    
                }
                else{
<span class="fc" id="L393">                    tankArr.get(turn - 1).shoot();</span>
<span class="fc" id="L394">                    tankArr.get(turn - 1).stopTurret();</span>
<span class="fc" id="L395">                    tankArr.get(turn - 1).stop();</span>
<span class="pc bpc" id="L396" title="1 of 2 branches missed.">                    if (this.turn &gt;= initialTankCount){</span>
<span class="nc" id="L397">                        this.turn = 1;</span>
                    }
                    else{
<span class="fc" id="L400">                        this.turn++;</span>
                        
                    }
<span class="pc bpc" id="L403" title="1 of 2 branches missed.">                    while (tankArr.get(turn - 1).getID() == 0){</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">                        if (this.turn == initialTankCount){</span>
<span class="nc" id="L405">                            this.turn = 1;</span>
                        }
                        else{
<span class="nc" id="L408">                            this.turn++;</span>
                        }
                        
                    }
                    
<span class="fc" id="L413">                    arrowDisplayTime = millis() + 2000;</span>
    
<span class="fc" id="L415">                    int windChange = random.nextInt(11) - 5;</span>
<span class="fc" id="L416">                    this.wind += windChange;</span>
                }
                
    
            }
    
<span class="pc bpc" id="L422" title="2 of 4 branches missed.">            if (keyCode == 'W' || keyCode == 'w'){</span>
<span class="nc" id="L423">                tankArr.get(turn - 1).increasePower();</span>
            }
    
<span class="pc bpc" id="L426" title="2 of 4 branches missed.">            if (keyCode == 'S' || keyCode == 's'){</span>
<span class="nc" id="L427">                tankArr.get(turn - 1).decreasePower();</span>
            }
    
<span class="pc bpc" id="L430" title="1 of 4 branches missed.">            if (keyCode == 'R' || keyCode == 'r'){</span>
<span class="fc" id="L431">                repairPowerUp();</span>
            }
<span class="pc bpc" id="L433" title="1 of 4 branches missed.">            if (keyCode == 'F' || keyCode == 'f'){</span>
<span class="fc" id="L434">                fuelPowerUp();</span>
            }
<span class="pc bpc" id="L436" title="1 of 4 branches missed.">            if (keyCode == 'P' || keyCode == 'p'){</span>
<span class="fc" id="L437">                parachutePowerUp();</span>
            }
<span class="pc bpc" id="L439" title="1 of 4 branches missed.">            if (keyCode == 'T' || keyCode == 't'){</span>
<span class="fc" id="L440">                teleportPowerUp();</span>
            }
<span class="pc bpc" id="L442" title="1 of 4 branches missed.">            if (keyCode == 'A' || keyCode == 'a'){</span>
<span class="fc" id="L443">                airStrikePowerUp();</span>
            }
        }

<span class="fc bfc" id="L447" title="All 2 branches covered.">        if(isGameOver){</span>
<span class="pc bpc" id="L448" title="2 of 4 branches missed.">            if (keyCode == 'R' || keyCode == 'r'){</span>
<span class="nc" id="L449">                isGameOver = false;</span>
<span class="nc" id="L450">                setup();</span>
            }
        }
<span class="fc" id="L453">    }</span>

    public void removeTank(int i){
<span class="fc" id="L456">        tankArr.get(i).setID(0);</span>
<span class="fc" id="L457">        tankCount--;</span>
<span class="fc bfc" id="L458" title="All 2 branches covered.">        if (turn == i + 1){</span>
<span class="fc" id="L459">            turn++;</span>
        }
        
<span class="fc" id="L462">    }</span>

    /**
    * Method to handle key releases.
    * Responds to key releases for stopping tank movement, etc.
    */
	@Override
    public void keyReleased(){
<span class="pc bpc" id="L470" title="1 of 2 branches missed.">        if (key == CODED){</span>
<span class="pc bpc" id="L471" title="2 of 4 branches missed.">            if (keyCode == RIGHT || keyCode == LEFT){</span>
<span class="nc" id="L472">                tankArr.get(turn - 1).stop();</span>
            }

<span class="pc bpc" id="L475" title="2 of 4 branches missed.">            else if (keyCode == UP || keyCode == DOWN){</span>
<span class="fc" id="L476">                tankArr.get(turn - 1).stopTurret();</span>
            }
        }
<span class="fc" id="L479">    }</span>

    /**
     * Method to handle mouse presses.
     * Responds to mouse clicks for using power-ups, etc.
     * @param e The MouseEvent object representing the mouse press event.
     */
    @Override
    public void mousePressed(MouseEvent e) {
        // TODO - powerups, like repair and extra fuel and teleport
<span class="pc bpc" id="L489" title="1 of 2 branches missed.">        if (isGameOver == false){</span>
<span class="fc bfc" id="L490" title="All 2 branches covered.">            if (teleportStatus){</span>
<span class="fc" id="L491">                int x = mouseX;</span>
    
<span class="fc" id="L493">                tankArr.get(turn - 1).x = x;</span>
<span class="fc" id="L494">                tankArr.get(turn - 1).y = terrainNew[x];</span>
<span class="fc" id="L495">                teleportStatus = false;</span>
            }
    
<span class="fc bfc" id="L498" title="All 2 branches covered.">            if(airStrikeStatus){</span>
<span class="fc" id="L499">                int x = mouseX;</span>
    
<span class="fc" id="L501">                tankArr.get(turn - 1).airStrikePowerUp(x);</span>
<span class="fc" id="L502">                airStrikeStatus = false;</span>
            }
    
<span class="pc bpc" id="L505" title="7 of 8 branches missed.">            if ((mouseX &gt;= 20 &amp;&amp; mouseX &lt;= 160) &amp;&amp; (mouseY &gt;= 50 &amp;&amp; mouseY &lt;= 80)){</span>
<span class="nc bnc" id="L506" title="All 2 branches missed.">                this.showPowerUp = !this.showPowerUp;</span>
            }
        }
<span class="fc" id="L509">    }</span>

    @Override
    public void mouseReleased(MouseEvent e) {

<span class="nc" id="L514">    }</span>

    /**
     * Draws the terrain grid on the screen using the specified color.
     * Each filled cell in the terrain grid is represented as a rectangle.
     * The color parameter determines the fill color of the rectangles.
     * @param color The color in which the terrain grid should be drawn.
     */

    public void drawTerrain(String color){

<span class="fc" id="L525">        setColor(color);</span>
   
<span class="fc bfc" id="L527" title="All 2 branches covered.">        for (int x = 0; x &lt; 864; x++){</span>
<span class="pc bpc" id="L528" title="1 of 2 branches missed.">            if(terrainNew[x] != 0){</span>
<span class="fc" id="L529">                rect(x, terrainNew[x], 1, HEIGHT - terrainNew[x]);</span>
<span class="fc" id="L530">                noStroke();</span>
            }
        }
<span class="fc" id="L533">    }</span>

    /**
     * Draws game sprites such as trees and tanks on the screen based on the terrain layout.
     * Trees and tanks are positioned according to their coordinates in the terrain grid.
     * Tree sprites are drawn at random x-coordinates within each terrain cell.
     */

    public void drawSprites(){
        
<span class="fc bfc" id="L543" title="All 2 branches covered.">        for (int x = 0; x &lt; BOARD_WIDTH; x++){</span>
<span class="fc bfc" id="L544" title="All 2 branches covered.">            for (int y = 0; y &lt; BOARD_HEIGHT; y++){</span>
               
<span class="fc bfc" id="L546" title="All 2 branches covered.">                if (terrain[x][y] == 'T'){</span>
<span class="fc" id="L547">                    int low = (x*CELLSIZE) - 15;</span>
<span class="fc" id="L548">                    int high = (x*CELLSIZE) + 15;</span>
<span class="fc" id="L549">                    int randomTreeLocation = random.nextInt(high-low) + low;</span>
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">                    if (randomTreeLocation &lt; 0){</span>
<span class="nc" id="L551">                        randomTreeLocation = 0;</span>
                    }
<span class="pc bpc" id="L553" title="1 of 2 branches missed.">                    if (randomTreeLocation &gt; 864){</span>
<span class="nc" id="L554">                        randomTreeLocation = 864;</span>
                    }
<span class="fc" id="L556">                    Tree t = new Tree(randomTreeLocation - CELLHEIGHT/2 , terrainNew[randomTreeLocation] - CELLHEIGHT, this.tree, terrainNew);</span>
<span class="fc" id="L557">                    treeArr.add(t);</span>
<span class="fc" id="L558">                }</span>
<span class="fc bfc" id="L559" title="All 4 branches covered.">                else if ((int) terrain[x][y] &gt;= 65 &amp;&amp; (int) terrain[x][y] &lt;= 73){</span>
<span class="fc" id="L560">                    int x_pixel = x*CELLSIZE;</span>

                    //Adding tanks to tank array
<span class="fc" id="L563">                    tankArr.get((int) terrain[x][y] - 65).x = x_pixel;</span>
<span class="fc" id="L564">                    tankArr.get((int) terrain[x][y] - 65).y = terrainNew[x_pixel];</span>
<span class="fc" id="L565">                    tankArr.get((int) terrain[x][y] - 65).setID((int) terrain[x][y] - 65 + 1);</span>
                }   
            }
        }
<span class="fc" id="L569">    }</span>
    
    /**
     * Displays the final scores of all players at the end of the game.
     * The scores are displayed in a scoreboard format with player names and scores.
     * The winning player's name is also highlighted.
     */

    public void displayScore(){
<span class="fc" id="L578">        ArrayList&lt;Tank&gt; sortedTanks = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L579" title="All 2 branches covered.">        for (int i = 0; i &lt; tankArr.size(); i++){</span>
<span class="pc bpc" id="L580" title="1 of 4 branches missed.">            if ((int)(tankArr.get(i).getName()) &gt;= 65 &amp;&amp; (int)(tankArr.get(i).getName()) &lt;= 65 + initialTankCount - 1){</span>
<span class="fc" id="L581">                sortedTanks.add(tankArr.get(i));</span>
            }

        }
<span class="fc" id="L585">        Collections.sort(sortedTanks);   </span>
<span class="fc" id="L586">        this.textSize(24);</span>
<span class="fc" id="L587">        setColor(sortedTanks.get(sortedTanks.size() - 1).getColor());</span>
<span class="fc" id="L588">        this.text(&quot;Player &quot; + sortedTanks.get(sortedTanks.size() - 1).getName() + &quot; wins!&quot;, 330, 130);</span>
<span class="fc" id="L589">        this.textSize(12);</span>

<span class="fc" id="L591">        setColorLight(sortedTanks.get(sortedTanks.size() - 1).getColor()); </span>
        
<span class="fc" id="L593">        this.stroke(2);</span>
<span class="fc" id="L594">        rect(200, 150, 400,40 + (35 * initialTankCount));</span>
<span class="fc" id="L595">        this.fill(0,0,0);</span>
<span class="fc" id="L596">        this.line(200, 190, 600, 190);</span>
<span class="fc" id="L597">        this.textSize(24);</span>
<span class="fc" id="L598">        text(&quot;Final Scores&quot;, 220, 180);</span>

<span class="fc bfc" id="L600" title="All 2 branches covered.">        if (currentIndex &lt; initialTankCount){</span>

<span class="fc bfc" id="L602" title="All 2 branches covered.">            if (millis() - lastWordTime &gt; wordInterval) {</span>
<span class="fc" id="L603">                displayedTanks.add(sortedTanks.get(sortedTanks.size() - 1 - currentIndex));</span>
<span class="fc" id="L604">                lastWordTime = millis();</span>
<span class="fc" id="L605">                currentIndex++;</span>
            }
        }
<span class="fc" id="L608">        fill(0);</span>
<span class="fc" id="L609">        this.textSize(24);</span>
<span class="fc bfc" id="L610" title="All 2 branches covered.">        for (int i = 0; i &lt; displayedTanks.size(); i++) {</span>

<span class="fc" id="L612">            setColor(displayedTanks.get(i).getColor());</span>
     
<span class="fc" id="L614">            text(&quot;Player &quot; + (displayedTanks.get(i).getName()), 220, 220 + i * 30);</span>
<span class="fc" id="L615">            this.fill(0,0,0);</span>
<span class="fc" id="L616">            text(displayedTanks.get(i).getScore(), 550, 220 + i * 30);</span>
        }

<span class="fc" id="L619">        text(&quot;Press R to restart game&quot;, 270, 220 + (35 * initialTankCount));</span>

<span class="fc" id="L621">        this.textSize(12);</span>
<span class="fc" id="L622">        this.noStroke();</span>
<span class="fc" id="L623">        this.scoreDisplayed = true;</span>
<span class="fc" id="L624">    }</span>

    /**
     * Sets the fill color used for subsequent drawings on the screen.
     * The color parameter should be specified as a string in the format &quot;R,G,B&quot;.
     * R, G, and B represent the red, green, and blue components of the color, respectively.
     * @param color The color string in the format &quot;R,G,B&quot;.
     */

    public void setColor(String color){
<span class="fc" id="L634">        String[] arr = color.split(&quot;,&quot;);</span>
    
<span class="fc" id="L636">        int a = Integer.parseInt(arr[0]);</span>
<span class="fc" id="L637">        int b = Integer.parseInt(arr[1]);</span>
<span class="fc" id="L638">        int c = Integer.parseInt(arr[2]);</span>
    
<span class="fc" id="L640">        this.fill(a,b,c);</span>
<span class="fc" id="L641">    }</span>

    public void setColorLight(String color){
<span class="fc" id="L644">        String[] arr = color.split(&quot;,&quot;);</span>

<span class="fc" id="L646">        int a = Integer.parseInt(arr[0]);</span>
<span class="fc" id="L647">        int b = Integer.parseInt(arr[1]);</span>
<span class="fc" id="L648">        int c = Integer.parseInt(arr[2]);</span>

<span class="fc" id="L650">        this.fill(a - 50,b - 50,c + 50, 170);    </span>
<span class="fc" id="L651">    } </span>

    /**
     * Method to update the game state and perform game logic for each frame.
     * This method manages tank movements, shooting, power-ups, terrain updates, etc.
     */
    public void tick(){

        //Checking if tank exploded
<span class="fc bfc" id="L660" title="All 4 branches covered.">        if (e != null &amp;&amp; e.isFinished() == false){</span>
<span class="fc" id="L661">            e.tick();</span>
<span class="fc" id="L662">            e.draw(this);</span>
            }

<span class="fc bfc" id="L665" title="All 2 branches covered.">        for (int i = 0; i &lt; tankArr.size(); i++){</span>
<span class="fc bfc" id="L666" title="All 2 branches covered.">            if (tankArr.get(i).getID() != 0){</span>
<span class="fc" id="L667">                tankArr.get(i).setWind(this.wind);</span>
<span class="fc" id="L668">                tankArr.get(i).tick(this);</span>
<span class="fc" id="L669">                tankArr.get(i).draw(this);</span>

                //Checking if tank is dead
<span class="fc bfc" id="L672" title="All 2 branches covered.">                if (tankArr.get(i).getHealth() &lt;= 0){</span>
<span class="fc" id="L673">                    tankArr.get(i).explode();</span>
<span class="fc" id="L674">                    e = new Explosion(tankArr.get(i).x, tankArr.get(i).y);</span>
<span class="fc" id="L675">                    removeTank(i);</span>
                }
            }   
        }

        // tankArr.get(turn-1).tick(this);
<span class="fc" id="L681">        tankArr.get(turn-1).setTerrain(terrainNew);</span>
        
<span class="fc bfc" id="L683" title="All 2 branches covered.">        for (int i = 0; i &lt; treeArr.size(); i++){</span>
<span class="fc" id="L684">            treeArr.get(i).setTerrain(terrainNew);</span>
<span class="fc" id="L685">            treeArr.get(i).tick();</span>
<span class="fc" id="L686">            treeArr.get(i).draw(this);</span>
        }

<span class="fc" id="L689">        this.fill(0,0,0);</span>

        //Which player's turn
<span class="fc" id="L692">        text(&quot;Player &quot; + (char) (turn + 64) + &quot;'s turn&quot;, 20, 30);</span>

        //PowerUp Box
<span class="fc" id="L695">        stroke(0);</span>
<span class="fc" id="L696">        strokeWeight(2);</span>
<span class="fc" id="L697">        line(20, 50, 165, 50);</span>
<span class="fc" id="L698">        line(20, 80, 165, 80);</span>
<span class="fc" id="L699">        line(20, 50, 20, 80);</span>
<span class="fc" id="L700">        line(165, 50, 165, 80);</span>
        
<span class="fc bfc" id="L702" title="All 2 branches covered.">        if (this.showPowerUp){</span>
<span class="fc" id="L703">            text(&quot;Click to hide powerups&quot;, 25, 70);</span>
<span class="fc" id="L704">            text(&quot;Repair Tank (R) - 20 Points&quot;, 20, 100);</span>
<span class="fc" id="L705">            text(&quot;Buy Fuel (F) - 10 Points&quot;, 20, 120);</span>
<span class="fc" id="L706">            text(&quot;Buy Parachute (P) - 15 Points&quot;, 20, 140);</span>
<span class="fc" id="L707">            text(&quot;Teleport (T) - 15 Points&quot;, 20, 160);</span>
<span class="fc" id="L708">            text(&quot;Launch AirStrike (A) - 50 Points&quot;, 20, 180);</span>
        }
        else{
<span class="fc" id="L711">            text(&quot;Click to see powerups&quot;, 25, 70);</span>
        }

        //Fuel bar
<span class="fc" id="L715">        text(tankArr.get(turn - 1).getFuel(), 300,30);</span>
<span class="fc" id="L716">        this.image(this.fuel, 260, 10, 32, 32);</span>

        //Parachute Count
<span class="fc" id="L719">        this.image(this.parachute, 150, 15);</span>
<span class="fc" id="L720">        text(tankArr.get(turn - 1).getParachutes(), 190, 35);</span>
        
        //Health and power Bar
<span class="fc" id="L723">        text(&quot;Health:&quot;, 350, 30);</span>
<span class="fc" id="L724">        setColor(tankArr.get(turn - 1).getColor());</span>
<span class="fc" id="L725">        stroke(0,0,0);</span>
<span class="fc" id="L726">        strokeWeight(2);</span>
<span class="fc" id="L727">        line(400, 15, 500, 15);</span>
<span class="fc" id="L728">        line(400, 35, 500, 35);</span>
<span class="fc" id="L729">        line(400, 15, 400, 35); </span>
<span class="fc" id="L730">        line(500, 15, 500, 35);</span>

<span class="fc" id="L732">        rect(400, 15, 100 * tankArr.get(turn - 1).getHealth() / 100, 20);</span>
<span class="fc" id="L733">        line(400 + (tankArr.get(turn - 1).getPower()), 15, 400 + (tankArr.get(turn - 1).getPower()), 35);</span>
                
<span class="fc" id="L735">        this.fill(0,0,0);</span>
<span class="fc" id="L736">        text(tankArr.get(turn - 1).getHealth(), 510, 30);</span>

        //Power Bar
<span class="fc" id="L739">        text(&quot;Power:&quot;, 350, 60);</span>
        // text(tankArr.get(turn - 1).getPower(), 550, 30);
<span class="fc" id="L741">        text((int)tankArr.get(turn - 1).getPower(), 400, 60);</span>

        //Wind Speed
<span class="fc bfc" id="L744" title="All 2 branches covered.">        if (this.wind &lt; 0){</span>
<span class="fc" id="L745">            this.image(this.wind_left, 600, 10);</span>
        }
        else{
<span class="fc" id="L748">            this.image(this.wind_right, 600, 10);</span>
        }
<span class="fc" id="L750">        text(this.wind, 645, 30);</span>


        //ScoreBoard
<span class="fc" id="L754">        stroke(0);</span>
<span class="fc" id="L755">        strokeWeight(3);</span>
<span class="fc" id="L756">        line(700, 30, 850, 30);</span>
<span class="fc" id="L757">        line(700, 30 + (30 * initialTankCount), 850, 30 + (30 * initialTankCount));</span>
<span class="fc" id="L758">        line(700, 30, 700, 30 + (30 * initialTankCount));</span>
<span class="fc" id="L759">        line(850, 30, 850, 30 + (30 * initialTankCount));</span>
<span class="fc" id="L760">        text(&quot;Scores&quot;, 710, 50);</span>
<span class="fc" id="L761">        line(700, 60, 850, 60);</span>

<span class="fc bfc" id="L763" title="All 2 branches covered.">        for (int i = 0; i &lt; initialTankCount; i++){</span>

<span class="fc" id="L765">            setColor(tankArr.get(i).getColor());</span>

<span class="fc" id="L767">            text(&quot;Player &quot; + (char)(i+65), 710, 80 + i * 20);</span>
<span class="fc" id="L768">            this.fill(0,0,0);</span>
<span class="fc" id="L769">            text(tankArr.get(i).getScore(), 800, 80 + i * 20); </span>
        }



        //Arrow Over Tank
<span class="fc bfc" id="L775" title="All 2 branches covered.">        if (millis() &lt; arrowDisplayTime){</span>
<span class="fc" id="L776">            int arrowStartX = tankArr.get(turn - 1).x + 9; </span>
<span class="fc" id="L777">            int arrowStartY = tankArr.get(turn - 1).y - 200; </span>
<span class="fc" id="L778">            int arrowEndX = tankArr.get(turn - 1).x + 9; </span>
<span class="fc" id="L779">            int arrowEndY = tankArr.get(turn - 1).y - 100; </span>
<span class="fc" id="L780">            stroke(0);</span>
<span class="fc" id="L781">            strokeWeight(2);</span>
<span class="fc" id="L782">            line(arrowStartX, arrowStartY, arrowEndX, arrowEndY);</span>
<span class="fc" id="L783">            line(arrowEndX-20, arrowEndY -20, arrowEndX, arrowEndY);</span>
<span class="fc" id="L784">            line(arrowEndX+20, arrowEndY -20, arrowEndX, arrowEndY);</span>
        }
        
<span class="fc" id="L787">        }</span>


    /**
     * Method to draw game elements on the screen.
     * Renders terrain, tanks, trees, HUD, etc.
     */
	@Override
    public void draw() {

<span class="fc" id="L797">        this.image(this.bg,0,0);</span>
<span class="fc" id="L798">        drawTerrain(this.fgColor);</span>
       
<span class="pc bpc" id="L800" title="1 of 2 branches missed.">        if (teleportStatus){</span>
<span class="nc" id="L801">            textSize(20);</span>
<span class="nc" id="L802">            fill(0,0,0);</span>
<span class="nc" id="L803">            text(&quot;SELECT X VALUE TO TELEPORT TO&quot;, 270, 200);</span>
<span class="nc" id="L804">            text(&quot;(CLICK ON SCREEN)&quot;, 330, 230);</span>
<span class="nc" id="L805">            textSize(12);</span>
        }

<span class="pc bpc" id="L808" title="1 of 2 branches missed.">        if (airStrikeStatus){</span>
<span class="nc" id="L809">            textSize(20);</span>
<span class="nc" id="L810">            fill(0,0,0);</span>
<span class="nc" id="L811">            text(&quot;SELECT X VALUE TO LAUNCH AIRSTRIKE AT&quot;, 220, 200);</span>
<span class="nc" id="L812">            text(&quot;(CLICK ON SCREEN)&quot;, 330, 230);</span>
<span class="nc" id="L813">            textSize(12);</span>
        }

<span class="fc" id="L816">        this.tick();</span>

<span class="fc bfc" id="L818" title="All 2 branches covered.">        if (isGameOver){</span>
<span class="fc" id="L819">            displayScore();</span>
        }
<span class="fc" id="L821">    }</span>

    public ArrayList&lt;Tank&gt; getTanks(){
<span class="nc" id="L824">        return this.tankArr;</span>
    }
    
    public int[] getTerrain(){
<span class="nc" id="L828">        return terrainNew;</span>
    }

    public static void main(String[] args) {
<span class="nc" id="L832">        PApplet.main(&quot;Tanks.App&quot;);</span>
<span class="nc" id="L833">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>